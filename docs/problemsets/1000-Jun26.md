# 2021 Jun 26

## ClassInstantiation

Steps to reproduce (No artifacts generated)

```bash
git clone https://gitlab.com/elijah-team/elijah-lang.git/
git checkout f0c9ef1488e8b9d639aaa083ceff624f13b65361
mvn -Dtest=tripleo.elijah.stages.deduce.ClassInstantiationTest#classInstantiation test
```

Test fails

* [classInstantiation](https://gitlab.com/elijah-team/elijah-lang/-/blob/f0c9ef1488e8b9d639aaa083ceff624f13b65361/src/test/java/tripleo/elijah/stages/deduce/ClassInstantiationTest.java#L24-29) fails because of [NPE](https://gitlab.com/elijah-team/elijah-lang/-/blob/f0c9ef1488e8b9d639aaa083ceff624f13b65361/src/main/java/tripleo/elijah/stages/deduce/DeduceTypes2.java#L654).

    * Fixed in # 317434d2717f6b003934bde0fdfefbfa4f55c432
  
* `Foo` generated twice
* `Prelude` `println` argument not wrapped; is unresolved
* `Prelude` `print` 
    * argument is unresolved
    * `a.printable` is UNKNOWN
* No implementation of `String8`
* No implementation of `ConstString` beyond declaration


## ClassInstantiation2

```bash
git clone https://gitlab.com/elijah-team/elijah-lang.git/
git checkout f0c9ef1488e8b9d639aaa083ceff624f13b65361
mvn -Dtest=tripleo.elijah.stages.deduce.ClassInstantiationTest#classInstantiation2 test
```

* [classInstantiation2](https://gitlab.com/elijah-team/elijah-lang/-/blob/f0c9ef1488e8b9d639aaa083ceff624f13b65361/src/test/java/tripleo/elijah/stages/deduce/ClassInstantiationTest.java#L31-37)

Test passes and generates COMP.

* `Bar`
    1. Named ctor (x) for Bar[T] id generated like a function
    2. Regular ctor is generated twice. (Maybe shouldn't be generated at all. Check language spec.)
    3. "class struct is generated twice"
    4. Member (_______, Z105) is `box Integer64`, not primitive
    
* `Foo`
    1. Generated twice
    
* `Main`
    1. Doesn't find class code for named ctor in declaration or constructor call
    2. Passing in primitives into a `IPrintable` slot
    
## Both 

* `Main`
    1. `println` is `Z0println`
    2. Can print better messages for `x` is UNKNOWN like ecj (to generate compilable, runnable code, although the point was to make the code uncompilable)
    
    
## TestBasic

Test Fails

```bash
mvn -Dtest=tripleo.elijah.TestBasic test
```

* [testBasic](https://gitlab.com/elijah-team/elijah-lang/-/blob/f0c9ef1488e8b9d639aaa083ceff624f13b65361/src/test/java/tripleo/elijah/TestBasic.java#L60) fails because of [NotImplementedException](https://gitlab.com/elijah-team/elijah-lang/-/blob/f0c9ef1488e8b9d639aaa083ceff624f13b65361/src/main/java/tripleo/elijah/stages/deduce/DeduceTypes2.java#L1433).
    
    * Fixed in # 8b010029c84fcfedf870cee9de83c618b1aa3bd4
    
Generates no COMP

But after, you apply that patch there is a COMP. Details below.

### listFolders3

#### Main

1. `z0arguments`: class `Arguments` is not beng recognized, but it is being generated
2. `MainLogic` is KNOWN, but `main` is UNKNOWN
3. `vsc->ExitCode` is assumed to be a part of MainLogic and not ns \`'
4. `vmExitSuccess` is assumed to be a part of MainLogic and not ns \`'

#### Prelude

5. Arguments is generated as a class. Actually this is ok, but it is never being initialized. Also class members are not present.
6. TTE is not being resolved for `Result`. Still a `USER` type.
7. `argument_count` is UNKNOWN (when it is a member of the class in question)

### listFolders4

8. Same as 1-4 for Main above
9. Same as 2-3 for Prelude above

### main2 (wprust.demo.fact)

#### Main.c

10. `b1` is not deduced, but is assigned `(type Z0*)`
11. `z0argument`: can't find `Arguments` class code
12. `vt1` is not declared
13. `a1.isInt` is UNKKNOWN, `a1.toInt` is UNKNOWN
14. `f1` is not deduced, but is assigned (type `Z0*`)
15. `factorial_r` does not have `self` argument
16. `z0println`: can't find namespace class code
17. calling `z0println` with primitive

#### fact1.c

18. TTE not resolved for `Result`
19. method body not generated
